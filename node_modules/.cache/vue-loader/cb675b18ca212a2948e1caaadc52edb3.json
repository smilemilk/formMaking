{"remainingRequest":"/Users/shanliguo/Documents/workstudy/vue-form-making/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/shanliguo/Documents/workstudy/vue-form-making/src/components/Upload/index.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/Users/shanliguo/Documents/workstudy/vue-form-making/src/components/Upload/index.vue","mtime":1557564977000},{"path":"/Users/shanliguo/Documents/workstudy/vue-form-making/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/shanliguo/Documents/workstudy/vue-form-making/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/shanliguo/Documents/workstudy/vue-form-making/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/shanliguo/Documents/workstudy/vue-form-making/node_modules/sass-loader/lib/loader.js","mtime":1533139052000},{"path":"/Users/shanliguo/Documents/workstudy/vue-form-making/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/shanliguo/Documents/workstudy/vue-form-making/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.fm-uplaod-container{\n  .is-disabled{\n    position: relative;\n\n    &::after{\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      // background: rgba(0,0,0,.1);\n      content: '';\n      display: block;\n      cursor:not-allowed;\n    }\n  }\n\n  .upload-file{\n    margin: 0 10px 10px 0;\n    display: inline-flex;\n    justify-content: center;\n    align-items: center;\n    // background: #fff;\n    overflow: hidden;\n    background-color: #fff;\n    border: 1px solid #c0ccda;\n    border-radius: 6px;\n    box-sizing: border-box;\n    position: relative;\n    vertical-align: top;\n    &:hover{\n      .uplaod-action{\n        display: flex;\n      }\n    }\n    .uplaod-action{\n      position: absolute;\n      // top: 0;\n      // height: 30px;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      background: rgba(0,0,0,0.6);\n      display: none;\n      justify-content: center;\n      align-items: center;\n      i{\n        color: #fff;\n        cursor: pointer;\n        margin: 0 5px;\n      }\n    }\n    &.is-success{\n      .item-status{\n        position: absolute;\n        right: -15px;\n        top: -6px;\n        width: 40px;\n        height: 24px;\n        background: #13ce66;\n        text-align: center;\n        transform: rotate(45deg);\n        box-shadow: 0 0 1pc 1px rgba(0,0,0,.2);\n        &>i{\n          font-size: 12px;\n          margin-top: 11px;\n          color: #fff;\n          transform: rotate(-45deg);\n        }\n      }\n    }\n    &.uploading{\n      &:before{\n        display: block;\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0,0,0,0.3);\n      }\n    }\n    .upload-progress{\n      position: absolute;\n      .el-progress__text{\n        color: #fff;\n        font-size: 16px !important;\n      }\n    }\n    img{\n      max-width: 100%;\n      max-height: 100%;\n      vertical-align: middle;\n    }\n  }\n  .el-upload--picture-card{\n    position: relative;\n    overflow: hidden;\n    .el-icon-plus{\n      position: absolute;\n      top: 50%;\n      left: 50%;\n    }\n  }\n  .upload-input{\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    display: block;\n    opacity: 0;\n    cursor: pointer;\n  }\n\n  .drag-img-list{\n    display: inline;\n\n    .ghost{\n      position: relative;\n      &::after {\n        width: 100%;\n        height: 100%;\n        display: block;\n        content: '';\n        background: #fbfdff;\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        border: 1px dashed #3bb3c2;\n      }\n    }\n\n    &>div{\n      cursor: move;\n    }\n  }\n}\n\n.viewer-container{\n  z-index: 9999 !important;\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiTA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/Upload","sourcesContent":["<template>\n  <div class=\"fm-uplaod-container\"\n    :id=\"uploadId\"\n  >\n    <draggable class=\"drag-img-list\"\n      v-model=\"fileList\"\n      v-bind=\"{group: uploadId, ghostClass: 'ghost', animation: 200}\"\n      :no-transition-on-drag=\"true\"\n    >\n      <div \n        :id=\"item.key\"\n        :style=\"{width: width+'px', height: height+'px'}\"\n        :class=\"{uploading: item.status=='uploading', 'is-success': item.status=='success', 'is-diabled': disabled}\"\n        class=\"upload-file\" v-for=\"(item) in fileList\" :key=\"item.key\">\n        <img :src=\"item.url\" />\n\n        <el-progress v-if=\"item.status=='uploading'\" :width=\"miniWidth*0.9\" class=\"upload-progress\" type=\"circle\" :percentage=\"item.percent\"></el-progress>\n\n        <label class=\"item-status\" v-if=\"item.status=='success'\">\n          <i class=\"el-icon-upload-success el-icon-check\"></i>\n        </label>\n\n        <div class=\"uplaod-action\" :style=\"{height: miniWidth / 4 + 'px'}\" v-if=\"!disabled\">\n          <i class=\"iconfont icon-tupianyulan\" title=\"预览\" @click=\"handlePreviewFile(item.key)\" :style=\"{'font-size': miniWidth/8+'px'}\"></i>\n          <i v-if=\"isEdit\" class=\"iconfont icon-sync1\" title=\"替换\" @click=\"handleEdit(item.key)\" :style=\"{'font-size': miniWidth/8+'px'}\"></i>\n          <i v-if=\"isDelete && fileList.length > min\" class=\"iconfont icon-delete\" title=\"删除\" @click=\"handleRemove(item.key)\" :style=\"{'font-size': miniWidth/8+'px'}\"></i>\n        </div>\n      </div>\n    </draggable>\n\n    <div class=\"el-upload el-upload--picture-card\"\n      :class=\"{'is-disabled': disabled}\"\n      v-show=\"(!isQiniu || (isQiniu && token)) && fileList.length < length\"\n      :style=\"{width: width+'px', height: height+'px'}\"\n      @click.self=\"handleAdd\"\n    >\n      <i class=\"el-icon-plus\" @click.self=\"handleAdd\" :style=\"{fontSize:miniWidth/4+'px',marginTop: (-miniWidth/8)+'px', marginLeft: (-miniWidth/8)+'px'}\"></i>\n      <input accept=\"image/*\" v-if=\"multiple\"  multiple ref=\"uploadInput\" @change=\"handleChange\" type=\"file\" :style=\"{width: 0, height: 0}\" name=\"file\" class=\"el-upload__input upload-input\">\n      <input accept=\"image/*\" v-else ref=\"uploadInput\" @change=\"handleChange\" type=\"file\" :style=\"{width:0, height: 0}\" name=\"file\" class=\"el-upload__input upload-input\">\n    </div>\n  </div>\n</template>\n\n<script>\nimport Viewer from 'viewerjs'\nimport Draggable from 'vuedraggable'\nimport * as qiniu from 'qiniu-js'\nrequire('viewerjs/dist/viewer.css')\nexport default {\n  components: {\n    Draggable\n  },\n  props: {\n    value: {\n      type: Array,\n      default: () => []\n    },\n    width: {\n      type: Number,\n      default: 100\n    },\n    height: {\n      type: Number,\n      default: 100\n    },\n    token: {\n      type: String,\n      default: ''\n    },\n    domain: {\n      type: String,\n      default: ''\n    },\n    multiple: {\n      type: Boolean,\n      default: false\n    },\n    length: {\n      type: Number,\n      default: 9\n    },\n    isQiniu: {\n      type: Boolean,\n      default: false\n    },\n    isDelete: {\n      type: Boolean,\n      default: false\n    },\n    min: {\n      type: Number,\n      default: 0\n    },\n    meitu: {\n      type: Boolean,\n      default: false\n    },\n    isEdit: {\n      type: Boolean,\n      default: false\n    },\n    action: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data () {\n    return {\n      fileList: this.value.map(item => {\n        return {\n          key: item.key ? item.key : (new Date().getTime()) + '_' + Math.ceil(Math.random() * 99999),\n          url: item.url,\n          percent: item.percent ? item.percent : 100,\n          status: item.status ? item.status : 'success'\n        }\n      }),\n      viewer: null,\n      uploadId: 'upload_' + new Date().getTime(),\n      editIndex: -1,\n      meituIndex: -1,\n    }\n  },\n  computed: {\n    miniWidth () {\n      if (this.width > this.height) {\n        return this.height\n      } else {\n        return this.width\n      }\n    }\n  },\n  mounted () {\n    this.$emit('input', this.fileList)\n  },\n  methods: {\n    handleChange () {\n      console.log(this.$refs.uploadInput.files)\n      const files = this.$refs.uploadInput.files\n      \n      for (let i = 0; i < files.length; i++) {\n        const file = files[i]\n        const reader = new FileReader()\n        const key = (new Date().getTime()) + '_' + Math.ceil(Math.random() * 99999)\n        reader.readAsDataURL(file)\n        reader.onload = () => {\n          if (this.editIndex >= 0) {\n\n            this.$set(this.fileList, this.editIndex, {\n              key,\n              url: reader.result,\n              percent: 0,\n              status: 'uploading'\n            })\n\n            this.editIndex = -1\n          } else {\n            this.fileList.push({\n              key,\n              url: reader.result,\n              percent: 0,\n              status: 'uploading'\n            })\n          }\n\n          this.$nextTick(() => {\n            if (this.isQiniu) {\n              this.uplaodAction2(reader.result, file, key)\n            } else {\n              this.uplaodAction(reader.result, file, key)\n            }\n          })\n        }\n      }\n      this.$refs.uploadInput.value = []\n    }, \n    uplaodAction (res, file, key) {\n      let changeIndex = this.fileList.findIndex(item => item.key === key)\n      console.log(this.fileList.findIndex(item => item.key === key))\n      const xhr = new XMLHttpRequest()\n      \n      const url = this.action\n      xhr.open('POST', url, true)\n      // xhr.setRequestHeader('Content-Type', 'multipart/form-data')\n\n      let formData = new FormData()\n      formData.append('file', file)\n\n      xhr.send(formData)\n      xhr.onreadystatechange = () => {\n        console.log(xhr)\n        if (xhr.readyState === 4) {\n          \n          let resData = JSON.parse(xhr.response)\n          if (resData && resData.url) {\n            this.$set(this.fileList, this.fileList.findIndex(item => item.key === key), {\n              ...this.fileList[this.fileList.findIndex(item => item.key === key)],\n              url: resData.url,\n              percent: 100\n            })\n            setTimeout(() => {\n              this.$set(this.fileList, this.fileList.findIndex(item => item.key === key), {\n                ...this.fileList[this.fileList.findIndex(item => item.key === key)],\n                status: 'success'\n              })\n              this.$emit('input', this.fileList)\n            }, 200)\n          } else {\n            this.$set(this.fileList, this.fileList.findIndex(item => item.key === key), {\n              ...this.fileList[this.fileList.findIndex(item => item.key === key)],\n              status: 'error'\n            })\n            this.fileList.splice(this.fileList.findIndex(item => item.key === key), 1)\n          }\n        }\n      }\n      xhr.onprogress = (res) => {\n        console.log('progress', res)\n        if (res.total && res.loaded) {\n          this.$set(this.fileList[this.fileList.findIndex(item => item.key === key)], 'percent', res.loaded/res.total*100)\n        }\n      }\n    },\n    uplaodAction2 (res, file, key) {\n      const _this = this\n      const observable = qiniu.upload(file, key, this.token, {\n        fname: key,\n        mimeType: []\n      }, {\n        useCdnDomain: true,\n        region: qiniu.region.z2\n      })\n      observable.subscribe({\n        next (res) {\n          _this.$set(_this.fileList[_this.fileList.findIndex(item => item.key === key)], 'percent', parseInt(res.total.percent))\n          \n        },\n        error (err) {\n          _this.$set(_this.fileList, _this.fileList.findIndex(item => item.key === key), {\n            ..._this.fileList[_this.fileList.findIndex(item => item.key === key)],\n            status: 'error'\n          })\n          _this.fileList.splice(_this.fileList.findIndex(item => item.key === key), 1)\n        },\n        complete (res) {\n          _this.$set(_this.fileList, _this.fileList.findIndex(item => item.key === key), {\n            ..._this.fileList[_this.fileList.findIndex(item => item.key === key)],\n            url: _this.domain + res.key,\n            percent: 100\n          })\n          setTimeout(() => {\n            _this.$set(_this.fileList, _this.fileList.findIndex(item => item.key === key), {\n              ..._this.fileList[_this.fileList.findIndex(item => item.key === key)],\n              status: 'success'\n            })\n            _this.$emit('input', _this.fileList)\n          }, 200)\n        }\n      })\n    },\n    handleRemove (key) {\n      this.fileList.splice(this.fileList.findIndex(item => item.key === key), 1)\n    },\n    handleEdit (key) {\n      \n      this.editIndex = this.fileList.findIndex(item => item.key === key)\n      \n      this.$refs.uploadInput.click()\n    },\n    handleMeitu (key) {\n\n      this.$emit('on-meitu', this.fileList.findIndex(item => item.key === key))\n    },\n    handleAdd () {\n      if (!this.disabled) {\n        this.editIndex = -1\n        this.$refs.uploadInput.click()\n      }\n    },\n    handlePreviewFile (key) {\n      this.viewer && this.viewer.destroy()\n      this.uploadId = 'upload_' + new Date().getTime()\n      \n      console.log(this.viewer)\n      this.$nextTick(() => {\n        this.viewer = new Viewer(document.getElementById(this.uploadId))\n        this.viewer.view(this.fileList.findIndex(item => item.key === key))\n      })\n    }\n  },\n  watch: {\n    'fileList': {\n      deep: true,\n      handler (val) {\n        // this.$emit('input', this.fileList)\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.fm-uplaod-container{\n  .is-disabled{\n    position: relative;\n\n    &::after{\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      // background: rgba(0,0,0,.1);\n      content: '';\n      display: block;\n      cursor:not-allowed;\n    }\n  }\n\n  .upload-file{\n    margin: 0 10px 10px 0;\n    display: inline-flex;\n    justify-content: center;\n    align-items: center;\n    // background: #fff;\n    overflow: hidden;\n    background-color: #fff;\n    border: 1px solid #c0ccda;\n    border-radius: 6px;\n    box-sizing: border-box;\n    position: relative;\n    vertical-align: top;\n    &:hover{\n      .uplaod-action{\n        display: flex;\n      }\n    }\n    .uplaod-action{\n      position: absolute;\n      // top: 0;\n      // height: 30px;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      background: rgba(0,0,0,0.6);\n      display: none;\n      justify-content: center;\n      align-items: center;\n      i{\n        color: #fff;\n        cursor: pointer;\n        margin: 0 5px;\n      }\n    }\n    &.is-success{\n      .item-status{\n        position: absolute;\n        right: -15px;\n        top: -6px;\n        width: 40px;\n        height: 24px;\n        background: #13ce66;\n        text-align: center;\n        transform: rotate(45deg);\n        box-shadow: 0 0 1pc 1px rgba(0,0,0,.2);\n        &>i{\n          font-size: 12px;\n          margin-top: 11px;\n          color: #fff;\n          transform: rotate(-45deg);\n        }\n      }\n    }\n    &.uploading{\n      &:before{\n        display: block;\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0,0,0,0.3);\n      }\n    }\n    .upload-progress{\n      position: absolute;\n      .el-progress__text{\n        color: #fff;\n        font-size: 16px !important;\n      }\n    }\n    img{\n      max-width: 100%;\n      max-height: 100%;\n      vertical-align: middle;\n    }\n  }\n  .el-upload--picture-card{\n    position: relative;\n    overflow: hidden;\n    .el-icon-plus{\n      position: absolute;\n      top: 50%;\n      left: 50%;\n    }\n  }\n  .upload-input{\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    display: block;\n    opacity: 0;\n    cursor: pointer;\n  }\n\n  .drag-img-list{\n    display: inline;\n\n    .ghost{\n      position: relative;\n      &::after {\n        width: 100%;\n        height: 100%;\n        display: block;\n        content: '';\n        background: #fbfdff;\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        border: 1px dashed #3bb3c2;\n      }\n    }\n\n    &>div{\n      cursor: move;\n    }\n  }\n}\n\n.viewer-container{\n  z-index: 9999 !important;\n}\n</style>\n"]}]}